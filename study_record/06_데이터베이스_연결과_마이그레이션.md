# 데이터베이스 연결과 마이그레이션

이번에는 laravel 로 어떻게 데이터베이스를 연결하고, 생성한 마이그레이션으로 데이터베이스에 마이그레이트를 하는지 시도해볼 것입니다.

먼저 `.env` 파일을 살펴봅시다.
이 프로젝트에서 필요한 `configuration` 들이 들어있는 걸 확인할 수 있습니다.

다음, `config` 디렉토리중, `database.php` 를 살펴봅시다.
`'default' => env('DB_CONNECTION', 'mysql'),`
기본적으로 `mysql` 로 설정되있는 걸 볼 수있습니다.

만약 `.env` 파일을 그대로 사용하면 보안에 문제가 생길 수 있기에, `config` 를 거쳐서 사용하는겁니다.
위의 `database.php`도 `env` 의 해당 값들을 가져와서 사용하는 겁니다.


## db 연결
그러면 `.env` 를 수정해서 데이터베이스에 연결해봅시다.
`.env` 안의 `DB_DATABASE` 값에다가 사용할 `db` 명을 입력합니다.
`DB_USERNAME`, `DB_PASSWORD` 는 따로 건드리지 않았기에 변경하지않습니다.
이제 우리는 데이터베이스에 접근할 수 있게 되었습니다.


## 마이그레이션(migration)
이제 `database` 의 `migration` 디렉토리를 살펴봅시다.
`mysql` 을 만들때, 데이터베이스를 만들고 그 데이터베이스 안에 테이블들을 만들겠죠?
테이블을 만들고, 그 안에 어떤 필드가 있는지 처음에 정해줄겁니다.

이러한 세팅을 처음에 해줘야하는데, 이를 `phpmyadmin` 나, `mysql dashboade` 등에서 직접 해주는 게 아니라 
`migration` 파일을 만들고 명령어로 테이블을 생성할 수 있게 `laravel` 에서 제공해줍니다.

이미 생성되어있는 파일들을 살펴봅시다.
`Schema::create('users', function (Blueprint $table) ...`
`up` 과 `down` 이 있는데, `up` 은 `migration` 을 실행했을 때, `users` 테이블을 만들고, 아래의 내용대로 필드를 만든다는 뜻입니다. 
만약 `migration` 을 되돌리고 싶으면 `down` 이 사용됩니다.

`laravel` 은 `create_users_table` 과 `create_password_reset_table` 을 기본적으로 제공하고 있습니다.
해당 파일들을 이용해서, 데이터베이스에 테이블을 생성해봅시다.

## 마이그레이션으로 테이블 생성
터미널을 실행 후, 다음 명령어를 실행합니다.
`php artisan migrate`

그러면 해당 파일대로 테이블이 생성되는 걸 확인할 수 있습니다.
실제로, 해당 `db` 를 새로고침하면, `migration` 파일대로 생성된걸 확인할 수 있습니다.

`migration` 테이블을 보면 마이그레이션한 목록들을 볼 수 있습니다.
제목앞에 보면 날짜가 있는데, 이것을 이용해 실행 순서가 정해집니다.
그리고 `batch` 컬럼을 보면 1이란 값을 볼 수있는데, 첫번째로 마이그레이트 됐단 뜻입니다.
만약 새로 `migration` 파일을 만들고, 이를 실행하면 `migration` 테이블에 해당 파일명이 추가될거고,
`batch` 레코드에 2가 기록될 것입니다.

만약, 빼먹은 레코드가 있어서 되돌리고 싶다면
`php artisan migrate:rollback`
명령어를 입력하면 테이블들이 삭제되있는 걸 확인할 수 있습니다.

하지만 `rollback` 은 테이블을 아예 삭제시키므로, 삭제시키기 않고 테이블 내용을 싹 밀고 변경사항을 적용하고싶으면
`php artisan migrate:fresh`
명령어를 입력합니다.

이렇게 `migration` 파일을 이용하면 좋은 점이, 다른 사람들이랑 협업할 때 git 같은걸로 버전관리를 하잖아요?
이를 이용해서 올려놓고, 다른 사람이 `migrate` 명령어만 사용하면 테이블들을 생성할 수 있습니다.

자신의 `migration` 파일을 만들고 싶다면 `Schema` 의 규칙에 맞게 작성하면됩니다.
옵션들의 기능은 공식 문서를 통해 확인할 수 있습니다.
